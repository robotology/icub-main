name: Continuous Integration

on:
  push:
  pull_request:
  schedule:
  # * is a special character in YAML so you have to quote this string
  # Execute a "nightly" build at 2 AM UTC
  - cron:  '0 2 * * *'

env:
  vcpkg_robotology_TAG: v0.0.3

jobs:

  docker-build:
    name: '[packages:@${{ matrix.docker_image }}]'
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        docker_image:
          - "ubuntu:focal"
          - "ubuntu:bionic"
          - "debian:buster"

    container:
      image: ${{ matrix.docker_image }}

    steps:
    - uses: actions/checkout@master

    - name: Get the version
      id: get_version
      run: echo ::set-output name=VERSION::$(echo $GITHUB_REF | cut -d / -f 3)

    - name: Generate icub-common metapackage [${{ matrix.docker_image }}]
      shell: bash
      run: |
        chmod +x ./.ci/create_icub-common_deb.sh
        echo "$GITHUB_REF"
        ./.ci/create_icub-common_deb.sh -V ${{ steps.get_version.outputs.VERSION }}

    # - name: Upload Release Asset
    #   if: github.event_name == 'release'
    #   uses: actions/upload-release-asset@v1.0.1
    #   env:
    #     GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
    #   with:
    #       upload_url: ${{ github.event.release.upload_url }}
    #       asset_path: packaging/windows/build/installer/idjl-software-installer.exe
    #       asset_name: idjl-software-installer.exe
    #       asset_content_type: application/octet-stream
